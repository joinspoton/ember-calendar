/* ember-calendar (https://github.com/joinspoton/ember-calendar) | (c) 2013 SpotOn (https://spoton.it) | http://www.opensource.org/licenses/MIT */
Ember.TEMPLATES["ember-calendar"]=Ember.Handlebars.compile("\n  <div class='ember-calendar-head'>\n    <div class='ember-calendar-head-previous'><button {{action loadPreviousWeek target='controller'}}>&laquo;</button></div>\n    {{view Ember.Calendar.HeadingDatesView datesBinding='controller.dates'}}\n    <div class='ember-calendar-head-next'><button {{action loadNextWeek target='controller'}}>&raquo;</button></div>\n  </div>\n  <div class='ember-calendar-container'>\n    <div class='ember-calendar-body'>\n      {{view Ember.Calendar.HeadingTimesView timesBinding='controller.times'}}\n      {{view Ember.Calendar.DaysView daysBinding='controller.days'}}\n    </div>\n  </div>\n");
Ember.TEMPLATES["ember-calendar-head-date"]=Ember.Handlebars.compile("\n\n\n  {{view.dateString}}\n");Ember.TEMPLATES["ember-calendar-head-time"]=Ember.Handlebars.compile("\n\n\n  {{view.timeString}}\n");Ember.TEMPLATES["ember-calendar-event"]=Ember.Handlebars.compile("\n\n\n  <div class='ember-calendar-event-name'>{{view.nameString}}</div>\n  <div class='ember-calendar-event-time'>{{view.timeString}}</div>\n  <div class='ember-calendar-event-location'>{{view.locationString}}</div>\n");
Ember.Calendar=Ember.Namespace.create();
Ember.Calendar.CalendarController=Ember.ArrayController.extend({startOfWeek:0,startOfDay:8,headingDateFormat:"ddd MMM D",headingTimeFormat:"h a",headingTimeRangeStart:0,headingTimeRangeEnd:24,eventTimeFormat:"h:mm a",eventTimeSeparator:" - ",headingDateViewClass:"Ember.Calendar.HeadingDateView",headingTimeViewClass:"Ember.Calendar.HeadingTimeView",dayViewClass:"Ember.Calendar.DayView",eventViewClass:"Ember.Calendar.EventView",week:null,dates:function(){if(!this.get("week"))return[];var a=this.get("week").clone().subtract("days",
1),b=[],c;for(c=0;7>c;c++)b.push(a.add("days",1).clone());return b}.property("week"),times:function(){var a=[],b;for(b=this.get("headingTimeRangeStart");b<this.get("headingTimeRangeEnd");b++)a.push(36E5*b);return a}.property("headingTimeRangeStart","headingTimeRangeStart"),days:function(){if(!this.get("week"))return[];var a=[[],[],[],[],[],[],[]],b=this.get("dates"),c=this;this.get("content").forEach(function(e){var f=moment(e.start).clone(),g=moment(e.end).clone(),d,h;if(!(g<b[0]||f>b[6]))for(;g>
f;)d={},Object.keys(e).forEach(function(a){"start"!==a&&"end"!==a&&(d[a]=e[a])}),d.start=f.clone(),d.end=f.clone().endOf("day"),d.end>g&&(d.end=g.clone()),h=d.start.clone().startOf("day").diff(c.get("week"),"days"),0<=h&&6>=h&&a[h].push(d),f.add("days",1).startOf("day")});return a}.property("content","dates"),loadPreviousWeek:function(){this.get("week").subtract("days",7);this.notifyPropertyChange("week")},loadNextWeek:function(){this.get("week").add("days",7);this.notifyPropertyChange("week")},init:function(){this._super();
this.set("week",moment(this.get("initialDate")).subtract("days",(moment(this.get("initialDate")).day()+7-this.get("startOfWeek"))%7))}});
Ember.Calendar.CalendarView=Ember.View.extend({templateName:"ember-calendar",classNames:["ember-calendar"],didInsertElement:function(){var a=$("#"+this.get("elementId")+" > .ember-calendar-container"),b=$("#"+this.get("elementId")+" > .ember-calendar-container > .ember-calendar-body"),c=(this.get("controller.startOfDay")-this.get("controller.headingTimeRangeStart"))/(this.get("controller.headingTimeRangeEnd")-this.get("controller.headingTimeRangeStart"));a.scrollTop(c*b.height())}});
Ember.Calendar.HeadingDatesView=Ember.ContainerView.extend({classNames:["ember-calendar-head-dates"],updateChildViews:function(){var a=this;this.removeAllChildren();$("#"+this.get("elementId")).html("");this.pushObjects(this.get("dates").map(function(b){return Ember.get(a.get("parentView.controller.headingDateViewClass")).create({date:b})}))}.observes("dates"),init:function(){this._super();this.updateChildViews()}});
Ember.Calendar.HeadingDateView=Ember.View.extend({templateName:"ember-calendar-head-date",classNames:["ember-calendar-head-date"],dateString:function(){return this.get("date").format(this.get("parentView.parentView.controller.headingDateFormat"))}.property("date")});
Ember.Calendar.HeadingTimesView=Ember.ContainerView.extend({classNames:["ember-calendar-head-times"],updateChildViews:function(){var a=this;this.removeAllChildren();$("#"+this.get("elementId")).html("");this.pushObjects(this.get("times").map(function(b){return Ember.get(a.get("parentView.controller.headingTimeViewClass")).create({time:b})}))}.observes("times"),init:function(){this._super();this.updateChildViews()}});
Ember.Calendar.HeadingTimeView=Ember.View.extend({templateName:"ember-calendar-head-time",classNames:["ember-calendar-head-time"],timeString:function(){return moment().startOf("day").add("milliseconds",this.get("time")).format(this.get("parentView.parentView.controller.headingTimeFormat"))}.property("time")});
Ember.Calendar.DaysView=Ember.ContainerView.extend({classNames:["ember-calendar-days"],updateChildViews:function(){var a=this;this.removeAllChildren();$("#"+this.get("elementId")).html("");this.pushObjects(this.get("days").map(function(b){return Ember.get(a.get("parentView.controller.dayViewClass")).create({events:b,parentView:a.get("parentView")})}))}.observes("days"),init:function(){this._super();this.updateChildViews()}});
Ember.Calendar.DayView=Ember.ContainerView.extend({classNames:["ember-calendar-day"],updateChildViews:function(){var a=this;this.removeAllChildren();$("#"+this.get("elementId")).html("");this.pushObjects(this.get("events").map(function(b){return Ember.get(a.get("parentView.controller.eventViewClass")).create({event:b,parentView:a.get("parentView")})}))}.observes("events"),init:function(){this._super();this.updateChildViews()}});
Ember.Calendar.EventView=Ember.View.extend({templateName:"ember-calendar-event",classNames:["ember-calendar-event"],attributeBindings:["style"],style:function(){if(!this.get("event"))return"";var a=moment(this.get("event.start")).valueOf(),b=moment(this.get("event.end")).valueOf(),c=moment(a).startOf("day").valueOf()+36E5*this.get("parentView.controller.headingTimeRangeStart"),e=moment(a).startOf("day").valueOf()+36E5*this.get("parentView.controller.headingTimeRangeEnd");return"top: "+100*(a-c)/(e-
c)+"%; height: "+100*(b-a)/(e-c)+"%;"}.property("event","event.start","event.end"),nameString:function(){return!this.get("event")?"":this.get("event.name")}.property("event","event.name"),timeString:function(){return!this.get("event")?"":this.get("event.start").format(this.get("parentView.controller.eventTimeFormat"))+this.get("parentView.controller.eventTimeSeparator")+this.get("event.end").format(this.get("parentView.controller.eventTimeFormat"))}.property("event","event.start","event.end"),locationString:function(){return!this.get("event")||
!this.get("event.location")?"":this.get("event.location.name")||this.get("event.location.address")}.property("event","event.location")});
